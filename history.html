<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Kazıma Tarihçesi</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1100px; margin: 0 auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 0.85em;} 
        th { background-color: #f2f2f2; }
        .success { color: green; font-weight: bold; }
        .failure { color: red; font-weight: bold; }
        .back-link { display: block; margin-bottom: 20px; text-decoration: none; color: #007bff;}
        .error-detail { color: #888; font-style: italic; font-size: 0.8em; max-width: 250px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    </style>
</head>
<body>
    <h1>Kazıma Tarihçesi</h1>
    <a href="{{ url_for('index') }}" class="back-link">← Ana Sayfaya Dön</a>
    
    {% if history_data %}
        <p style="font-size: 0.9em; color: #555;">Bu tablo, her bir URL'nin kazıma durumunu ayrı ayrı listeler. (En son işlem en üstte)</p>
        <div style="overflow-x: auto;"> 
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Tarih</th>
                        <th>URL</th>
                        <th>Durum</th>
                        <th>Veri Sayısı</th>
                        <th>Durum Kodu</th>
                        <th>Hata/Uyarı</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in history_data %}
                        <tr>
                            <td>{{ log.id }}</td>
                            <td>{{ log.timestamp }}</td>
                            <td title="{{ log.url }}">{{ log.url | truncate(60, True) }}</td>
                            <td class="{{ 'success' if log.success else 'failure' }}">
                                {{ 'BAŞARILI' if log.success else 'BAŞARISIZ' }}
                            </td>
                            <td>{{ log.data_count }}</td>
                            <td>{{ log.status_code }}</td>
                            <td class="error-detail" title="{{ log.error_msg | default('N/A', True) }}">
                                {{ log.error_msg | default('N/A', True) }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>Henüz herhangi bir kazıma işlemi kaydedilmemiştir.</p>
    {% endif %}

</body>
</html>